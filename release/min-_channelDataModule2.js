(function(){var t={},i=function(){var i=function(){!function(t){t.fromAce=function(t){var i=[];return t.forEach(function(t){var n=t.range;"insertText"==t.action&&i.push([1,n.start.row,n.start.column,n.end.row,n.end.column,t.text]),"removeText"==t.action&&i.push([2,n.start.row,n.start.column,n.end.row,n.end.column,t.text]),"insertLines"==t.action&&i.push([3,n.start.row,n.start.column,n.end.row,n.end.column,t.lines]),"removeLines"==t.action&&i.push([4,n.start.row,n.start.column,n.end.row,n.end.column,t.lines,t.nl])}),i},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){}),t.reverse=function(t){var i=[];return t.forEach(function(t){{var n=t.slice();n[1],n[2],n[3],n[4]}return 1==n[0]?(n[0]=2,void i.unshift(n)):2==n[0]?(n[0]=1,void i.unshift(n)):3==n[0]?(n[0]=4,void i.unshift(n)):4==n[0]?(n[0]=3,void i.unshift(n)):void 0}),i},t.runToAce=function(t){var i=[],n=["","insertText","removeText","insertLines","removeLines"];return t.forEach(function(t){var r={action:n[t[0]],range:{start:{row:t[1],column:t[2]},end:{row:t[3],column:t[4]}}};t[0]<3?r.text=t[5]:r.lines=t[5],4==t[0]&&(r.nl=t[6]||"\n"),i.push(r)}),i},t.runToLineObj=function(t,i){i.forEach(function(i){var n=i[1],r=i[2],e=i[3],_=i[4];if(1==i[0])if("\n"==i[5]){var a=t.item(n);if(a){var s=a.text();a.text(s.slice(0,r));var o={text:s.slice(r)||""};t.insertAt(n+1,o)}else t.insertAt(n,{text:""}),t.insertAt(n+1,{text:""})}else{var a=t.item(n);if(a){var s=a.text();a.text(s.slice(0,r)+i[5]+s.slice(r))}else t.insertAt(n,{text:i[5]})}if(2==i[0])if("\n"==i[5]){var f=t.item(n),d=t.item(n+1),h="",c="";f&&(h=f.text()),d&&(c=d.text()),f?f.text(h+c):t.insertAt(n,{text:""}),d&&d.remove()}else{var a=t.item(n),s=a.text();a.text(s.slice(0,r)+s.slice(_))}if(3==i[0])for(var u=e-n,l=0;u>l;l++)t.insertAt(n+l,{text:i[5][l]});if(4==i[0])for(var u=e-n,l=0;u>l;l++){var a=t.item(n);a.remove()}})},t.runToString=function(t,i){if(!i||"undefined"==typeof t)return"";t+="";var n=t.split("\n");return i.forEach(function(t){var i=t[1],r=t[2],e=t[3],_=t[4];if(1==t[0])if("\n"==t[5]){var a=n[i]||"";n[i]=a.slice(0,r);var s=a.slice(r)||"";n.splice(i+1,0,s)}else{var a=n[i]||"";n[i]=a.slice(0,r)+t[5]+a.slice(r)}if(2==t[0])if("\n"==t[5]){var o=n[i]||"",f=n[i+1]||"";n[i]=o+f,n.splice(i+1,1)}else{var a=n[i]||"";n[i]=a.slice(0,r)+a.slice(_)}if(3==t[0])for(var d=e-i,h=0;d>h;h++)n.splice(i+h,0,t[5][h]);if(4==t[0])for(var d=e-i,h=0;d>h;h++)n.splice(i,1)}),n.join("\n")},t.simplify=function(t){var i,n=[],r=null;return t.forEach(function(t){i&&1==t[0]&&1==i[0]&&t[3]==t[1]&&i[1]==t[1]&&i[3]==t[3]&&i[4]==t[2]?r?(r[3]=t[3],r[4]=t[4],r[5]=r[5]+t[5]):(r=[],r[0]=1,r[1]=i[1],r[2]=i[2],r[3]=t[3],r[4]=t[4],r[5]=i[5]+t[5]):(r&&(n.push(r),r=null),1==t[0]?r=t.slice():n.push(t)),i=t}),r&&n.push(r),n}}(this)},n=function(t,i,r,e,_,a,s,o){var f,d=this;if(!(d instanceof n))return new n(t,i,r,e,_,a,s,o);var h=[t,i,r,e,_,a,s,o];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){f=t.apply(d,h)}),"function"==typeof f){if(f._classInfo.name!=n._classInfo.name)return new f(t,i,r,e,_,a,s,o)}else if(f)return f;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,h)}):"function"==typeof d.init&&d.init.apply(d,h)};n._classInfo={name:"aceCmdConvert"},n.prototype=new i;var r=function(){!function(t){t._posChange=function(t,i,n,r){var e=this._find(t);if(e){var _=this._find(i),a=this._find(r),s=this._find(n),o=[],f=[];if(s&&!_&&s._fc!=e.__id&&(o.push([s.__id,3,s._fc]),f.push([s.__id,3,e.__id])),e.__p&&e.__p!=n){var d=this._find(e.__p);d._fc==t&&(o.push([e.__p,3,t]),f.push([e.__p,3,e._n]))}return e._p&&i!=e._p&&(o.push([e._p,2,t]),f.push([e._p,2,e._n])),_&&_._n!=e.__id&&(o.push([i,2,_._n]),f.push([i,2,t])),a&&a._p!=e.__id&&(o.push([r,0,a._p]),f.push([r,0,t])),e._n&&r!=e._n&&(o.push([e._n,0,t]),f.push([e._n,0,e._p])),e._n!=r&&(o.push([t,2,e._n]),f.push([t,2,r])),e._p!=i&&(o.push([t,0,e._p]),f.push([t,0,i])),e.__p!=n&&(o.push([t,1,e.__p]),f.push([t,1,n])),[22,f,o,0,t]}},t.guid=function(){return Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)},t.isArray=function(t){return t instanceof Array},t.isFunction=function(t){return"[object Function]"==Object.prototype.toString.call(t)},t.isObject=function(t){return t===Object(t)},t.moveDown=function(t){var i=this._find(t);if(i){var n=this._find(i._p);if(n){var r=this._posChange(t,n._p,i.__p,n.__id);this.execCmd(r)}}},t.moveUp=function(t){var i=this._find(t);if(i){var n=this._find(i._n);if(n){var r=this._posChange(t,n.__id,i.__p,n._n);this.execCmd(r)}}},t.push=function(t,i){var n=this._find(t),r=this._find(i);if(n&&r){var e;if(n._fc){for(var _=n._fc,a=this._find(_);a._n;)a=this._find(a._n);var s=this._posChange(i,a.__id,t,e);this.execCmd(s)}else{var s=this._posChange(i,e,t,e);console.log(s),this.execCmd(s)}}},t.remove=function(t){var i=this._find(t);if(i){var n,r=this._posChange(t,n,n,n);this.execCmd(r)}}}(this),function(t){var i,r,e,_,a,s;t._cmd_aceCmd=function(t,i){var r=this._find(t[4]),_=t[1];if(!r||!_)return!1;if("string"!=typeof r.data[_])return!1;var a=n();r.data[_]=a.runToString(r.data[_],t[2]),e=i;var s=[4,_,r.data[_],null,t[4]];return this._cmd(s,r,null),i?this._cmd(t,r,null):this.writeCommand(t),e=!1,this._fireListener(r,_),!0},t._cmd_createArray=function(t,i){var n=t[1];if(!n)return!1;var r=this._getObjectHash();if(r[n])return!1;var e={data:{},__id:n,__p:null};return r[e.__id]=e,this._data.__objects.push(e),i||this.writeCommand(t,e),!0},t._cmd_createObject=function(t,i){var n=t[1];if(!n)return!1;var r=this._getObjectHash();if(r[n])return!1;var e={data:{},__id:n,__p:null};return t[2]&&(e._class=t[2]),r[e.__id]=e,this._data.__objects.push(e),i||this.writeCommand(t,e),!0},t._cmd_moveToIndex=function(t,i){var n,e=this._find(t[4]),_=e.data.length,a=0;if(!e)return!1;var s=null;for(a=0;_>a;a++){var o=e.data[a];if(o.__id==t[1]){n=o,s=a;break}}if(s!=t[3]||!n)return!1;var f=parseInt(t[2]);return isNaN(f)?!1:e.data.length<=a?!1:(r.fromIndex=a,e.data.splice(a,1),e.data.splice(f,0,n),this._cmd(t,e,n),i||_isRemoteUpdate||this.writeCommand(t),!0)},t._cmd_position=function(t,i,n,r){r||(r=this._delta);var e=t[4],_=t[2],a=t[1],s=this._find(t[4]),o=(this._find(_[2]),this._find(a[2]));if((s._p||_[0])&&_[0]!=s._p)return!1;if((s._n||_[1])&&_[1]!=s._n)return!1;if((s.__p||_[2])&&_[2]!=s.__p)return!1;if(o&&o.__id==s.__id)return!1;if((s._p||a[0])&&a[0]==s._p)return!1;if((s._n||a[1])&&a[1]==s._n)return!1;var f=this._find(a[0]),d=this._find(a[1]),o=this._find(a[2]);if(f){if(d&&d._p!=f.__id)return!1;if(d&&d.__p!=f.__p)return!1;if(!d&&f._n)return!1}else{if(d&&d._p)return!1;if(d&&d.__p!=o.__id)return!1;if(!d&&o&&o._fc)return!1}if(s._p){var h=this._find(s._p),c=this._find(s._n);c?(h._n=c.__id,c._p=h.__id,r&&(this._deltaPatchMeta(r,h.__id,"_n",c.__id),this._deltaPatchMeta(r,c.__id,"_p",h.__id))):(h._n=null,r&&this._deltaPatchMeta(r,h.__id,"_n",null))}else{var u=this._find(s.__p),c=this._find(s._n);u&&c&&(u._fc=c.__id,r&&this._deltaPatchMeta(r,u.__id,"_fc",c.__id)),u&&!c&&(u._fc=null,r&&this._deltaPatchMeta(r,u.__id,"_fc",null)),c&&(c._p=null,r&&this._deltaPatchMeta(r,c.__id,"_p",null))}if(s._p=a[0],s._n=a[1],s.__p=a[2],r){r[e]||(r[e]={data:{}});var l=r[e];l._p=s._p,l._n=s._n,l.__p=s.__p}if(f){var c=this._find(f._n);c?(f._n=s.__id,c._p=s.__id,r&&(this._deltaPatchMeta(r,d.__id,"_n",s.__id),this._deltaPatchMeta(r,c.__id,"_p",s.__id))):(f._n=s.__id,r&&this._deltaPatchMeta(r,f.__id,"_n",s.__id))}else{var u=this._find(s.__p);u&&(u._fc=s.__id,r&&this._deltaPatchMeta(r,u.__id,"_fc",s.__id)),d&&(d._p=s.__id,r&&this._deltaPatchMeta(r,d.__id,"_p",s.__id))}return n||this._cmd(t),i||this.writeCommand(t),!0},t._cmd_position2=function(t){for(var i=(t[4],t[2]),n=t[1],r=i.length,e=0;r>e;e++){var _=i[e],a=n[e],s=this._find(_[0]);if(0==_[1]&&s._p!=_[2])return!1;if(1==_[1]&&s.__p!=_[2])return!1;if(2==_[1]&&s._n!=_[2])return!1;if(3==_[1]&&s._fc!=_[2])return!1}for(var e=0;r>e;e++){var _=i[e],a=n[e],s=this._find(_[0]);0==_[1]&&(s._p=a[2]),1==_[1]&&(s.__p=a[2]),2==_[1]&&(s._n=a[2]),3==_[1]&&(s._fc=a[2])}return!0},t._cmd_pushToArray=function(t,i){{var n=this._find(t[4]),r=this._find(t[2]),e=parseInt(t[1]);t[3],n.data.length}if(!n||!r)return!1;if(r.__p)return!1;if(isNaN(e))return!1;if(this.isArray(n.data))return e>n.data.length?!1:(n.data.splice(e,0,r),r.__p=n.__id,this._cmd(t,n,r),this._moveCmdListToParent(r),i||this.writeCommand(t),!0)},t._cmd_removeObject=function(t,i){var n=this._find(t[4]),r=this._find(t[2]),e=parseInt(t[1]);if(!n||!r)return!1;if(!r.__p)return!1;var _=n.data.indexOf(r);return isNaN(e)?!1:e!=_?!1:(n.data.splice(_,1),this._cmd(t,n,r),r.__p=null,i||this.writeCommand(t),!0)},t._cmd_setMeta=function(t,i){var n=this._find(t[4]),r=t[1];return r?"data"==r?!1:"__id"==r?!1:n?n[r]==t[2]?!1:(n[r]=t[2],this._cmd(t,n,null),i||this.writeCommand(t),!0):!1:!1},t._cmd_setProperty=function(t,i,n,r){var e=t[4],_=this._find(e),a=t[1];if(!_||!a)return!1;var o=_.data[a];if(o==t[2])return!1;if("undefined"!=typeof o){if(o!=t[3])return!1}else if(this.isObject(o)||this.isArray(o))return!1;if(r||(r=this._delta),_._class){var f=s[_._class];if(f&&f.validateSet&&!f.validateSet.apply(_,[a,t[2],o]))return!1}return _.data[a]=t[2],r&&(r[e]||(r[e]={data:{}}),r[e].data[a]=t[2]),n||this._cmd(t),i||this.writeCommand(t),!0},t._cmd_setPropertyObject=function(t,i){var n=this._find(t[4]),r=t[1],e=this._find(t[2]);return n&&r&&e?"undefined"!=typeof n.data[r]?!1:(n.data[r]=e,e.__p=n.__id,this._cmd(t,n,e),i||(this._moveCmdListToParent(e),this.writeCommand(t)),!0):!1},t._cmd_unsetProperty=function(t,i){var n=this._find(t[4]),r=t[1];return n&&r&&this.isObject(n.data[r])?(delete n.data[r],i||this.writeCommand(t),!0):!1},t._deltaPatch=function(t,i,n,r){t[i]||(t[i]={data:{}}),t[i].data[n]=r},t._deltaPatchMeta=function(t,i,n,r){t[i]||(t[i]={data:{}}),t[i][n]=r},t._fireListener=function(t,n){if(i){var r=t.__id+"::"+n,e=i[r];e&&e.forEach(function(i){i(t,t.data[n])})}},t._moveCmdListToParent=function(){},t._reverse_aceCmd=function(t){var i=this._find(t[4]),r=t[1],e=n(),_=e.reverse(t[2]),a=[4,r,i.data[r],null,t[4]],s=[13,r,_,null,t[4]],o=e.runToString(i.data[r],_);i.data[r]=o,this._cmd(a),this._cmd(s)},t._reverse_createObject=function(t){var i=t[1],n=this._getObjectHash();delete n[i]},t._reverse_moveToIndex=function(t){var i,n=this._find(t[4]),r=n.data.length,e=0,_=null;for(e=0;r>e;e++){var a=n.data[e];if(a.__id==t[1]){i=a,_=e;break}}if(_!=t[2])throw"_reverse_moveToIndex with invalid index value";if(i){var s=parseInt(t[3]);n.data.splice(e,1),n.data.splice(s,0,i);var o=t.slice();o[2]=s,o[3]=t[2],this._cmd(o)}},t._reverse_position=function(t){var i=[21,t[2],t[1],0,t[4]];return this._cmd_position(i,!0,!0)},t._reverse_position2=function(t){var i=[22,t[2],t[1],0,t[4]];return this._cmd_position2(i,!0,!0)},t._reverse_pushToArray=function(t){{var i=this._find(t[4]),n=this._find(t[2]);i.data.length}if(i&&n){var r=i.data.length-1,e=i.data[r];if(e.__id==t[2]){var _=[8,r,e.__id,null,i.__id];i.data.splice(r,1),this._cmd(_)}}},t._reverse_removeObject=function(t){{var i=this._find(t[4]),n=this._find(t[2]),r=t[1];i.data.indexOf(n)}if(i&&n){i.data.splice(r,0,n);var e=[7,r,t[2],null,t[4]];this._cmd(e),n.__p=t[4]}},t._reverse_setMeta=function(t){var i=this._find(t[4]),n=t[1];if(i){var r=[3,n,t[3],t[2],t[4]];i[n]=t[3],this._cmd(r)}},t._reverse_setProperty=function(t){var i=this._find(t[4]),n=t[1];if(i){var r=[4,n,t[3],t[2],t[4]];i.data[n]=t[3],this._cmd(r)}},t._reverse_setPropertyObject=function(t){var i=this._find(t[4]),n=t[1],r=this._find(t[2]);if(i&&r){delete i.data[n],r.__p=null;var e=[10,n,null,null,t[4]];this._cmd(e)}},t._reverse_unsetProperty=function(t){var i=this._find(t[4]),n=this._find(t[2]),r=t[1];if(i&&r&&n){i.data[r]=n,n.__p=i.__id;var e=[5,r,n.__id,0,t[4]];this._cmd(e)}},t._setDelta=function(t){this._delta=t},t.apply=function(t){for(var i=t.length,n=0;i>n;n++){var r=t[n];this.execCmd(r,!0)}},t.collectToDiff=function(t,i){var n=this;i.forEach(function(i){if(4==i[0]){var r=n._find(i[4]),e=i[1];return void(r&&n._deltaPatch(t,i[4],e,r.data[e]))}if(21!=i[0]);else{var _=i[4],r=n._find(_);if(r){t[_]||(t[_]={data:{}});var a=t[_];a._p=r._p,a._n=r._n,a.__p=r.__p;var s=n._find(r.__p);s&&(t[s.__id]||(t[s.__id]={data:{}}),t[s.__id]._fc=s._fc)}}})},t.conditionalRunner=function(t,i,n,r){for(var e=(clientJournal.splice(),function(t,i){return t.forEach(function(t,n){if(22==t[0])for(var r=t[2],e=t[1],_=r.length,n=0;_>n;n++){var a=r[n],s=e[n],o=a[0];i[o]||(i[o]={has:new Array(4),sets:new Array(4),froms:new Array(4),firsts:new Array(4)});var f=i[o],d=a[1];f.sets[d]=s[2],f.has[d]=!0,"undefined"==typeof f.firsts[d]&&(f.firsts[d]=s[2],f.froms[d]=a[2])}}),i}),_=function(t){var i=[],n=[];for(var r in t)if(t.hasOwnProperty(r))for(var e=t[r],_=0;3>=_;_++)e.has[_]&&(i.push([r,_,e.froms[_]]),n.push([r,_,e.sets[_]]));return[22,n,i]},a=e(i,{}),s=e(n,{}),o=(e(r,{}),[]),f=[],d=!1,h={},c=0;c<r.length;c++){var u=r[c];if(22==u[0])for(var l=u[2],p=u[1],v=l.length,c=0;v>c;c++){var m,y,w=l[c],j=p[c],C=w[0],b=a[C];m=w.slice(),y=j.slice();var I=!0;if(b){var P=j[1];b.has[P]&&(b.sets[P]!=j[2]?m[2]=b.sets[P]:I=!1)}var g=s[C];if(g){var P=j[1];g.has[P]&&(I=!1,d=!0,g.froms[P]=y[2])}I&&(o.push(m),f.push(y))}}return h.bReconstructLocal=d,d&&(h.unset_pos_rebuild=_(g)),h.pos_changes=[22,f,o],h},t.deltaDiffToCmds=function(t,i){var n=[];for(var r in i)if(i.hasOwnProperty(r)){var e=i[r],_=t[r];if(!_){var a=[1,r,e._class];_=t[r]={data:{},__id:r},n.push(a)}if("undefined"!=typeof e._p&&"undefined"!=typeof e._n&&(!_||e._p!=_._p||e._n!=_._n||e.__p!=_.__p)){var a=[21,[e._p,e._n,e.__p],[_._p,_._n,_.__p],0,r];n.push(a)}for(var s in e.data)if(e.data.hasOwnProperty(s)&&_.data[s]!=e.data[s]){var a=[4,s,e.data[s],_.data[s],r];n.push(a)}}return n},t.execCmd=function(t,i,n,r){try{if(!this.isArray(t))return!1;var e=_[t[0]];if(e){var a=e.apply(this,[t,i,!1,r]);return a&&!n&&this.writeLocalJournal(t),a}return!1}catch(s){return!1}},t.getJournalLine=function(){return this._journalPointer},t.getLocalJournal=function(){return this._journal},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){i||(i={},r={}),_||(a=new Array(30),_=new Array(30),_[1]=this._cmd_createObject,_[2]=this._cmd_createArray,_[3]=this._cmd_setMeta,_[4]=this._cmd_setProperty,_[5]=this._cmd_setPropertyObject,_[7]=this._cmd_pushToArray,_[8]=this._cmd_removeObject,_[10]=this._cmd_unsetProperty,_[12]=this._cmd_moveToIndex,_[13]=this._cmd_aceCmd,_[22]=this._cmd_position2,a[3]=this._reverse_setMeta,a[4]=this._reverse_setProperty,a[5]=this._reverse_setPropertyObject,a[7]=this._reverse_pushToArray,a[8]=this._reverse_removeObject,a[10]=this._reverse_unsetProperty,a[12]=this._reverse_moveToIndex,a[13]=this._reverse_aceCmd,a[22]=this._reverse_position2)}),t.redo=function(t){var i=this.getJournalLine();for(t=t||1;t-->0;){var n=this._journal[i];if(!n)return;this.execCmd(n,!1,!0),i++,this._journalPointer++}},t.registerClass=function(t,i){s||(s={}),s[t]=i},t.reverseCmd=function(t){console.log("reversing command ",t);var i=a[t[0]];if(i){var n=i.apply(this,[t]);return n}},t.reverseNLines=function(t){for(var i=this.getJournalLine();i-1>=0&&t-->0;){var n=this._journal[i-1];this.reverseCmd(n),i--,this._journalPointer--}},t.reverseToLine=function(t){for(var i=this.getJournalLine();i-1>=0&&i>t;){var n=this._journal[i-1];this.reverseCmd(n),i--,this._journalPointer--}},t.undo=function(t){0!==t&&("undefined"==typeof t&&(t=1),this.reverseNLines(t))},t.writeLocalJournal=function(t){this._journal&&(this._journal.length>this._journalPointer&&(this._journal.length=this._journalPointer),this._journal.push(t),this._journalPointer++)}}(this),function(t){var i,n;t._addToCache=function(t){t&&t.__id&&(this._objectHash[t.__id]=t)},t.hasOwnProperty("__factoryClass")||(t.__factoryClass=[]),t.__factoryClass.push(function(t){return i||(i={}),i[t]?i[t]:void(i[t]=this)}),t._cmd=function(t){var i=t[0],r=t[4];if(this._workers[i]&&this._workers[i][r]){var e=this._workers[i][r],_=t[1],a=e["*"],s=e[_];a&&a.forEach(function(i){var r=i[0],e=i[1],_=n[r];_&&_(t,e)}),s&&s.forEach(function(i){var r=i[0],e=i[1],_=n[r];_&&_(t,e)})}},t._createModelCommands=function(t,i,n){n||(n=[]);var r;if(r=t.data&&t.__id?t.data:t,this.isObject(r)||this.isArray(r)){var e;if(e=t.__id?t:{data:r,__id:this.guid()},this.isArray(r))var _=[2,e.__id,[],null,e.__id];else var _=[1,e.__id,{},null,e.__id];i&&(e.__p=i.__id),n.push(_);for(var a in r)if(r.hasOwnProperty(a)){var s=r[a];if(this.isObject(s)||this.isArray(s)){var o=this._createModelCommands(s,e,n),_=[5,a,o.__id,null,e.__id];n.push(_)}else{var _=[4,a,s,null,e.__id];n.push(_)}}return e}},t._createNewModel=function(t,i){if(this.isObject(t)||this.isArray(t)){var n={data:t,__id:this.guid()};if(this._objectHash[n.__id]=n,this.isArray(t))var r=[2,n.__id,[],null,n.__id];else var r=[1,n.__id,{},null,n.__id];i&&(n.__p=i.__id),this.writeCommand(r,n);for(var e in t)if(t.hasOwnProperty(e)){var _=t[e];if(this.isObject(_)||this.isArray(_)){var a=this._createNewModel(_,n);n.data[e]=a;var r=[5,e,a.__id,null,n.__id];this.writeCommand(r,n),this._moveCmdListToParent(a)}else{var r=[4,e,_,null,n.__id];this.writeCommand(r,n)}}return n}},t._find=function(t){return this._objectHash[t]},t._findObjects=function(t){if(!t)return null;if(!this.isObject(t))return t;if(t.__objects){var i=this,n=function(t){i._objectHash[t.__id]=t};t.__objects.forEach(n)}return t.__id&&(this._objectHash[t.__id]=t),t},t._getObjectHash=function(){return this._objectHash},t._prepareData=function(t){var i=this._wrapData(t);return this._objectHash[i.__id]||(i=this._findObjects(i)),i},t._wrapData=function(t){if(t&&t._wrapData)return t._data;if(t.__id&&t.data)return t;var i=this._createNewModel(t);return i},t.createWorker=function(t,i,n){var r=i[0],e=i[4];this._workers[r]||(this._workers[r]={}),this._workers[r][e]||(this._workers[r][e]={});var _=this._workers[r][e],a=i[1];a||(a="*"),_[a]||(_[a]=[]),_[a].push([t,n])},t.getData=function(){return this._data},t.getJournal=function(){return this._journal},t.indexOf=function(t){if(t||(t=this._data),this.isObject(t)||(t=this._find(t)),t){var i=this._find(t.__p);if(i&&this.isArray(i.data))return i.data.indexOf(t)}},t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(t,i,n){if(i){this._objectHash||(this._objectHash={}),i.__objects||(i.__objects=[]);var r=this;this._channelId=t,this._data=i,this._workers={},this._journal=n||[],this._journalPointer=this._journal.length;var e=this._findObjects(i);e!=i&&(this._data=e),n&&this.isArray(n)&&n.forEach(function(t){r.execCmd(t,!0)})}}),t.setWorkerCommands=function(t){n||(n={});for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},t.toPlainData=function(t){if("undefined"==typeof t&&(t=this._data),!this.isObject(t))return t;var i;if(this.isArray(t.data)){i=[];for(var n=t.data.length,r=0;n>r;r++)i[r]=this.toPlainData(t.data[r])}else{i={};for(var e in t.data)t.data.hasOwnProperty(e)&&(i[e]=this.toPlainData(t.data[e]))}return i},t.writeCommand=function(t){this._cmdBuffer||(this._cmdBuffer=[]),this._cmdBuffer.push(t)}}(this)},e=function(t,i,n,r,_,a,s,o){var f,d=this;if(!(d instanceof e))return new e(t,i,n,r,_,a,s,o);var h=[t,i,n,r,_,a,s,o];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){f=t.apply(d,h)}),"function"==typeof f){if(f._classInfo.name!=e._classInfo.name)return new f(t,i,n,r,_,a,s,o)}else if(f)return f;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,h)}):"function"==typeof d.init&&d.init.apply(d,h)};e._classInfo={name:"_channelData"},e.prototype=new r,function(){"undefined"!=typeof define&&null!==define&&null!=define.amd?(t._channelData=e,this._channelData=e):"undefined"!=typeof module&&null!==module&&null!=module.exports?module.exports._channelData=e:this._channelData=e}.call(new Function("return this")()),function(t){t.__traitInit&&!t.hasOwnProperty("__traitInit")&&(t.__traitInit=t.__traitInit.slice()),t.__traitInit||(t.__traitInit=[]),t.__traitInit.push(function(){})}(this)},n=function(t,i,r,e,_,a,s,o){var f,d=this;if(!(d instanceof n))return new n(t,i,r,e,_,a,s,o);var h=[t,i,r,e,_,a,s,o];if(d.__factoryClass)if(d.__factoryClass.forEach(function(t){f=t.apply(d,h)}),"function"==typeof f){if(f._classInfo.name!=n._classInfo.name)return new f(t,i,r,e,_,a,s,o)}else if(f)return f;d.__traitInit?d.__traitInit.forEach(function(t){t.apply(d,h)}):"function"==typeof d.init&&d.init.apply(d,h)};n._classInfo={name:"channelObjects"},n.prototype=new i,"undefined"!=typeof define&&null!==define&&null!=define.amd&&define(t)}).call(new Function("return this")());